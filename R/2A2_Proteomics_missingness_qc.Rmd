---
title: ""
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
    number_sections: true
    code_folding: hide
---

# Introduction



# Setup and Dependencies

```{r packages, message=FALSE, warning=FALSE, echo=TRUE}
suppressPackageStartupMessages({
library("purrr")
library("metafor")
library("dplyr")
library("readxl")
library("ggplot2")
library("tidyverse")
library("readr")
library("DESeq2")
library("dplyr")
library("stringr")
library("biomaRt")
  
})
```


# 

```{r, message=FALSE, warning=FALSE, echo=TRUE}

processed_path <- "/mnt/vol1/Multi-Omics-Cancer-Subtype-Discovery/data/processed"

clinical_a<- readRDS(file.path(processed_path, "clinical_a.rds"))
prot_a<- readRDS(file.path(processed_path, "proteomics_a.rds"))
rna_a<- readRDS(file.path(processed_path, "transcriptomics_a.rds"))

print(dim(clinical_a))
print(dim(prot_a))
print(dim(rna_a))


```

# drop proteins missing in >40% of samples

```{r gtex, message=FALSE, warning=FALSE, echo=TRUE}

missing_per_protein <- colMeans(is.na(prot_a))
keep <- missing_per_protein <= 0.40
prot_qc <- prot_a[, keep, drop = FALSE]

print(paste("Proteins before:", ncol(prot_a)))
print(paste("Proteins after :", ncol(prot_qc)))

```

Two types of imputations are present such as;

1. Median Imputation
We fill the hole with the "average" value of the observed patients. 
Biological Implication: we are telling the model, "we didn't see this protein in Patient B, so we will assume Patient B has a 'normal' amount of it."

2. MinProb / LOD Imputation

We fill the hole with a very low number (e.g., the lowest value observed in the dataset minus a small amount).

Biological Implication: "we didn't see this protein, so it must be close to zero."

The Verdict:

Median Imputation is the standard "First Pass" approach for Subtype Discovery (Clustering).

Why: In clustering, we want to find groups driven by positive signal (high expression).

By using the median (neutral), we are effectively "silence" the missing data. We prevent the missing values from driving the clustering.

If We had used MinProb (filling with low values), our clusters might have formed based on "Which patients had missing data?" (Batch effects) rather than "Which patients had high expression?" (Biology)



```{r, message=FALSE, warning=FALSE, echo=TRUE}

prot_imp <- prot_qc

for (j in seq_len(ncol(prot_imp))) {
  med <- median(prot_imp[, j], na.rm = TRUE)
  prot_imp[is.na(prot_imp[, j]), j] <- med
}

print(paste("Missing after imputation:", sum(is.na(prot_imp))))


saveRDS(prot_imp, file.path(processed_path, "proteomics_qc_imputed.rds"))
saveRDS(clinical_a,file.path(processed_path, "clinical_a.rds"))
saveRDS(rna_a, file.path(processed_path, "transcriptomics_a.rds"))

```





```{r, message=FALSE, warning=FALSE, echo=TRUE}

sessionInfo()


```

